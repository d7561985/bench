test:
  pre:
    - go get github.com/mattn/goveralls
    - go get github.com/wadey/gocovmerge
  override:
    - go test -v -cover -race -coverprofile=bench.coverprofile ./bench
    - go test -v -cover -race -coverprofile=bench.errors.coverprofile ./bench/errors
    - go test -v -cover -race -coverprofile=bench.results.coverprofile ./bench/results
    - go test -v -cover -race -coverprofile=bench.semaphore.coverprofile ./bench/semaphore
    - go test -v -cover -race -coverprofile=bench.commands.coverprofile ./bench/commands
    - go test -v -cover -race -coverprofile=plugin.shared.coverprofile ./plugin/shared
    - go test -v -cover -race -coverprofile=server.coverprofile ./server
  post:
    - gocovmerge *.coverprofile > coveralls.coverprofile
    - goveralls -coverprofile=coveralls.coverprofile -service=circle-ci -repotoken=$COVERALLS_TOKEN

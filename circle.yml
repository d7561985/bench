machine:
  environment:
    GOPATH: /home/ubuntu/go
    WKDIR: $GOPATH/src/github.com/nicholasjackson

dependencies:
  pre:
    - mkdir -p $WKDIR
    - cp -R /home/ubuntu/bench $WKDIR/
    - go get -u github.com/go-playground/overalls

test:
  override:
    - cd $WKDIR/bench && go get -t -d -v -race ./...
    - cd $WKDIR/bench && go build -v
    - cd $WKDIR/bench && overalls -project=github.com/nicholasjackson/bench -covermode=atomic
    - cd $WKDIR/bench && mv overalls.coverprofile coverage.txt
    - cd $WKDIR/bench && bash <(curl -s https://codecov.io/bash)
